<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-AMIs (캐미s) - Ant Village</title>
    <!-- CSS 파일들 (순서 중요: 변수 → 레이아웃 → 컴포넌트 → 페이지 → 반응형) -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/pages-main.css">
    <link rel="stylesheet" href="css/pages-analysis.css">
    <link rel="stylesheet" href="css/pages-mypage.css">
    <link rel="stylesheet" href="css/responsive.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <!-- 로그인 페이지 -->
    <div id="loginPage" class="page active">
        <div class="login-container">
            <div class="login-card">
                <div class="login-logo">
                    <img src="public/logo2.png" alt="K-AMIs Logo" class="login-logo-image">
                </div>

                <h1 class="login-title">K-AMIs (캐미s)</h1>
                <p class="login-subtitle">개미 마을에 오신 것을 환영합니다</p>

                <form class="login-form" onsubmit="handleLogin(event)">
                    <div class="login-input-group">
                        <label for="loginId" class="login-label">아이디</label>
                        <input
                            type="text"
                            id="loginId"
                            class="login-input"
                            placeholder="아이디를 입력하세요"
                            autocomplete="username"
                        >
                    </div>

                    <div class="login-input-group">
                        <label for="loginPw" class="login-label">비밀번호</label>
                        <input
                            type="password"
                            id="loginPw"
                            class="login-input"
                            placeholder="비밀번호를 입력하세요"
                            autocomplete="current-password"
                        >
                    </div>

                    <button type="submit" class="login-button">
                        로그인
                    </button>
                </form>

                <div class="login-footer">
                    <p style="color: var(--text-light); font-size: 14px;">
                        💡 데모 버전: 아이디와 비밀번호를 입력하시면 바로 로그인됩니다
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- 헤더 -->
    <header id="mainHeader" style="display: none;">
        <div class="container">
            <div class="logo" onclick="showPage('main')">
                <img src="public/logo2.png" alt="K-AMIs Logo" class="logo-image">
                <span class="logo-text">K-AMIs (캐미s)</span>
            </div>

            <!-- 햄버거 메뉴 버튼 (모바일 전용) -->
            <button class="hamburger-menu" onclick="toggleMobileMenu()" aria-label="메뉴">
                <span></span>
                <span></span>
                <span></span>
            </button>

            <!-- 데스크톱 네비게이션 -->
            <nav class="desktop-nav">
                <button onclick="showPage('main')">홈</button>
                <button onclick="showPage('villages')">마을 관리</button>
                <button onclick="showPage('briefing')">일일 브리핑</button>
                <button onclick="showPage('neighbors')">이웃 마을</button>
                <button onclick="showPage('analysis')">포트폴리오 분석</button>
                <button onclick="showPage('mypage')">마이페이지</button>
                <button onclick="logout()" class="logout-button">로그아웃</button>
            </nav>
        </div>
    </header>

    <!-- 모바일 사이드 메뉴 -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-overlay" onclick="closeMobileMenu()"></div>
        <div class="mobile-menu-content">
            <div class="mobile-menu-header">
                <div class="mobile-menu-logo">
                    <img src="public/logo2.png" alt="K-AMIs Logo" class="mobile-logo-image">
                    <span class="mobile-logo-text">K-AMIs</span>
                </div>
                <button class="mobile-menu-close" onclick="closeMobileMenu()" aria-label="닫기">&times;</button>
            </div>
            <nav class="mobile-nav">
                <button onclick="showPage('main'); closeMobileMenu();">
                    <span class="nav-icon">🏠</span>
                    <span>홈</span>
                </button>
                <button onclick="showPage('villages'); closeMobileMenu();">
                    <span class="nav-icon">🏘️</span>
                    <span>마을 관리</span>
                </button>
                <button onclick="showPage('analysis'); closeMobileMenu();">
                    <span class="nav-icon">📊</span>
                    <span>포트폴리오 분석</span>
                </button>
                <button onclick="showPage('briefing'); closeMobileMenu();">
                    <span class="nav-icon">📢</span>
                    <span>일일 브리핑</span>
                </button>
                <button onclick="showPage('neighbors'); closeMobileMenu();">
                    <span class="nav-icon">👥</span>
                    <span>이웃 마을 개미</span>
                </button>
                <button onclick="showPage('mypage'); closeMobileMenu();">
                    <span class="nav-icon">👤</span>
                    <span>마이페이지</span>
                </button>
                <button onclick="logout()" class="mobile-logout-button">
                    <span class="nav-icon">🚪</span>
                    <span>로그아웃</span>
                </button>
            </nav>
        </div>
    </div>

    <!-- 메인 페이지 -->
    <div id="mainPage" class="page active">
        <div class="hero">
            <h1>개미 마을</h1>
            <p>"방치된 내 주식, 개미 마을이 깨워줍니다."</p>
            <button class="cta-button" onclick="showPage('villages')">내 마을 시작하기 🚀</button>
        </div>

        <!-- 지도, 차트, 요약을 같은 라인에 표시하는 컨테이너 -->
        <div class="main-content-wrapper">
            <!-- 지도 섹션 -->
            <div class="world-map">
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--dark);">전 세계 나의 투자 마을</h2>

                <!-- 새로운 추천 알림 배너 -->
                <div class="recommendation-banner" id="recommendationBanner" style="display: none;" onclick="goToRecommendations()">
                    <div class="banner-icon">✨</div>
                    <div class="banner-content">
                        <div class="banner-title">새로운 이웃 마을 추천</div>
                        <div class="banner-subtitle">포트폴리오를 다각화할 수 있는 마을을 추천드립니다</div>
                    </div>
                    <div class="banner-arrow">→</div>
                </div>

                <div class="map-container">
                    <img src="public/map.svg" alt="세계 지도" class="map-image">

                    <!-- 클릭 가능한 지역 핫스팟 -->
                    <div class="map-hotspot hotspot-korea" onclick="showVillageDetail('국장마을')" title="한국">
                        <span class="hotspot-label">🇰🇷 한국</span>
                        <span class="unread-badge" id="badge-국장마을" style="display: none;">NEW</span>
                    </div>
                    <div class="map-hotspot hotspot-usa" onclick="showVillageDetail('미장마을')" title="미국">
                        <span class="hotspot-label">🇺🇸 미국</span>
                        <span class="unread-badge" id="badge-미장마을" style="display: none;">NEW</span>
                    </div>
                    <!--
                    <div class="map-hotspot hotspot-europe" onclick="showVillageDetail('배당마을')" title="유럽">
                        <span class="hotspot-label">🇪🇺 유럽</span>
                        <span class="unread-badge" id="badge-배당마을" style="display: none;">NEW</span>
                    </div>
                    <div class="map-hotspot hotspot-asia" onclick="showVillageDetail('글로벌ETF마을')" title="아시아">
                        <span class="hotspot-label">🌏 아시아</span>
                        <span class="unread-badge" id="badge-글로벌ETF마을" style="display: none;">NEW</span>
                    </div>
                    -->
                    
                    <!-- 추천 마을 핫스팟 -->
                    <div class="map-hotspot hotspot-recommendation" id="recommendationHotspot" style="display: none;" onclick="goToRecommendations()" title="새로운 추천">
                        <span class="hotspot-label">✨ 추천</span>
                        <span class="recommendation-pulse"></span>
                    </div>
                </div>
            </div>

            <!-- 자산 분포 차트 섹션 -->
            <div class="asset-chart-section">
                <h2 class="section-title">내 자산 분포</h2>
                <p class="section-subtitle">유형별 자산 비중</p>

                <div class="chart-container">
                    <canvas id="assetPieChart"></canvas>
                </div>
            </div>

            <!-- 자산 요약 섹션 -->
            <div class="asset-summary-section">
                <h2 class="section-title">자산 요약</h2>
                <p class="section-subtitle">마을별 자산 현황</p>

                <div class="chart-legend">
                    <h3>총 자산</h3>
                    <div class="total-assets" id="totalAssets">0원</div>

                    <div class="legend-items" id="legendItems">
                        <!-- JavaScript로 동적 생성 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 마을 관리 페이지 -->
    <div id="villagesPage" class="page">
        <div class="container">
            <h1 class="page-title">나의 마을 관리</h1>
            <p class="page-subtitle">내 자산을 성격에 따라 마을로 분리하세요</p>

            <!-- 필터 탭 -->
            <div class="village-filter-tabs">
                <button class="filter-tab active" onclick="filterVillages('all')">전체</button>
                <button class="filter-tab" onclick="filterVillages('country')">국가별</button>
                <button class="filter-tab" onclick="filterVillages('type')">유형별</button>
                <button class="filter-tab" onclick="filterVillages('custom')">사용자 지정</button>
                <button class="add-village-button" onclick="openAddVillageModal()">+ 마을 추가</button>
            </div>

            <div class="village-grid" id="villageGrid">
                <!-- JavaScript로 동적 생성 -->
            </div>
        </div>
    </div>

    <!-- 포트폴리오 분석 페이지 -->
    <div id="analysisPage" class="page">
        <!-- 로딩 오버레이 -->
        <div id="analysisLoading" class="analysis-loading-overlay">
            <div class="analysis-loading-content">
                <div class="analysis-loading-spinner"></div>
                <div class="analysis-loading-text">포트폴리오 분석 중...</div>
                <div class="analysis-loading-bar">
                    <div class="analysis-loading-progress" id="analysisLoadingProgress"></div>
                </div>
                <div class="analysis-loading-status" id="analysisLoadingStatus">데이터를 불러오고 있습니다</div>
            </div>
        </div>

        <div class="container">
            <div class="analysis-header">
                <div>
                    <h1 class="page-title">포트폴리오 분석</h1>
                    <p class="page-subtitle">나의 투자 현황을 한눈에 분석하세요</p>
                </div>
                <div class="download-buttons">
                    <button class="download-btn excel" onclick="downloadExcel()">
                        <span class="download-icon">📊</span>
                        <span>Excel 다운로드</span>
                    </button>
                    <button class="download-btn pdf" onclick="downloadPDF()">
                        <span class="download-icon">📄</span>
                        <span>PDF 다운로드</span>
                    </button>
                </div>
            </div>

            <!-- 요약 카드 섹션 -->
            <div class="analysis-summary-grid">
                <div class="analysis-card">
                    <div class="analysis-card-icon">💰</div>
                    <div class="analysis-card-label">총 자산</div>
                    <div class="analysis-card-value" id="analysisTotalAssets">0원</div>
                    <div class="analysis-card-change positive" id="analysisAssetChange">+0원 (0%)</div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-card-icon">📈</div>
                    <div class="analysis-card-label">총 수익률</div>
                    <div class="analysis-card-value" id="analysisTotalReturn">0%</div>
                    <div class="analysis-card-change positive" id="analysisReturnChange">전월 대비 +0%p</div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-card-icon">🏘️</div>
                    <div class="analysis-card-label">운영 마을</div>
                    <div class="analysis-card-value" id="analysisVillageCount">0개</div>
                    <div class="analysis-card-change" id="analysisVillageInfo">0개 자산 보유</div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-card-icon">🎯</div>
                    <div class="analysis-card-label">투자 성향</div>
                    <div class="analysis-card-value" id="analysisRiskLevel">-</div>
                    <div class="analysis-card-change" id="analysisRiskDesc">진단 미완료</div>
                </div>
            </div>

            <!-- 차트 섹션 -->
            <div class="analysis-charts-grid">
                <!-- 마을별 수익률 차트 -->
                <div class="analysis-chart-card">
                    <h2 class="analysis-section-title">마을별 수익률</h2>
                    <div class="chart-container-analysis">
                        <canvas id="villagePerformanceChart"></canvas>
                    </div>
                </div>

                <!-- 자산 유형별 분포 -->
                <div class="analysis-chart-card">
                    <h2 class="analysis-section-title">자산 유형 분포</h2>
                    <div class="chart-container-analysis">
                        <canvas id="assetTypeDistributionChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- 상위/하위 종목 -->
            <div class="analysis-performance-grid">
                <div class="performance-card">
                    <h2 class="analysis-section-title">🏆 수익률 TOP 5</h2>
                    <div class="performance-list" id="topPerformers">
                        <!-- JavaScript로 동적 생성 -->
                    </div>
                </div>
                <div class="performance-card">
                    <h2 class="analysis-section-title">📉 수익률 BOTTOM 5</h2>
                    <div class="performance-list" id="bottomPerformers">
                        <!-- JavaScript로 동적 생성 -->
                    </div>
                </div>
            </div>

            <!-- 리밸런싱 추천 -->
            <div class="rebalancing-section">
                <h2 class="analysis-section-title">💡 리밸런싱 추천</h2>
                <div class="rebalancing-cards" id="rebalancingRecommendations">
                    <!-- JavaScript로 동적 생성 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 아침 브리핑 페이지 -->
    <div id="briefingPage" class="page">
        <div class="container">
            <h1 class="page-title">개미 일일 브리핑</h1>
            <p class="page-subtitle">마을별 대표 개미를 선택하고 브리핑을 들어보세요</p>

            <div class="briefing-container">
                <!-- 마을 선택 섹션 -->
                <div class="village-selector">
                    <h3 style="text-align: center; color: var(--primary); margin-bottom: 20px;">🏘️ 마을 선택</h3>
                    <div class="briefing-filter-tabs">
                        <button class="filter-tab active" onclick="filterBriefingVillages('all')">전체</button>
                        <button class="filter-tab" onclick="filterBriefingVillages('country')">국가별</button>
                        <button class="filter-tab" onclick="filterBriefingVillages('type')">유형별</button>
                        <button class="filter-tab" onclick="filterBriefingVillages('custom')">사용자 지정</button>
                    </div>
                    <div class="village-selector-grid" id="villageSelectorGrid">
                        <!-- JavaScript로 동적 생성 -->
                    </div>
                </div>

                <!-- 선택된 마을 브리핑 -->
                <div id="selectedVillageBriefing" style="display: none;">
                    <div class="ant-character">
                        <div class="ant-avatar" id="briefingAntAvatar">🐜</div>
                        <div class="ant-name" id="briefingVillageName">마을을 선택하세요</div>
                    </div>

                    <div class="briefing-content" id="briefingContent">
                        <!-- JavaScript로 동적 생성 -->
                    </div>

                    <div class="audio-controls">
                        <button class="audio-button" onclick="playBriefing()">🔊 음성으로 듣기</button>
                        <button class="audio-button" onclick="stopBriefing()">⏹️ 정지</button>
                        <button class="audio-button" onclick="showVillageSelector()">다른 마을 선택</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 마을 분석 페이지 -->
    <div id="dailyBriefingPage" class="page">
        <div class="container">
            <h1 class="page-title">마을 분석</h1>
            <p class="page-subtitle">마을의 수익률과 성과를 분석합니다</p>

            <!-- 마을 정보 헤더 -->
            <div style="text-align: center; margin: 30px 0;">
                <div class="ant-avatar" style="font-size: 80px; margin-bottom: 20px;">🏘️</div>
                <h2 class="ant-name" id="dailyVillageName" style="font-size: 32px; color: var(--primary); margin-bottom: 25px;">미장마을</h2>

                <!-- 요약 정보 카드 -->
                <div style="background: var(--card-bg); border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 800px; margin: 0 auto;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 25px;">
                        <div class="village-summary-item">
                            <div style="color: var(--text-light); font-size: 15px; margin-bottom: 10px; font-weight: 500;">💰 총 자산</div>
                            <div id="villageAnalysisTotalValue" style="font-size: 28px; font-weight: 700; color: var(--dark);">0원</div>
                        </div>
                        <div class="village-summary-item">
                            <div style="color: var(--text-light); font-size: 15px; margin-bottom: 10px; font-weight: 500;">📈 현재 수익률</div>
                            <div id="villageAnalysisReturnRate" style="font-size: 28px; font-weight: 700;">0%</div>
                        </div>
                        <div class="village-summary-item">
                            <div style="color: var(--text-light); font-size: 15px; margin-bottom: 10px; font-weight: 500;">📊 보유 종목</div>
                            <div id="villageAnalysisAssetCount" style="font-size: 28px; font-weight: 700; color: var(--dark);">0개</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 수익률 차트 -->
            <div style="background: var(--card-bg); padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 30px;">
                <h2 style="color: var(--primary); font-size: 24px; font-weight: 700; margin-bottom: 20px;">📊 월별 수익률 추이</h2>
                <div style="position: relative; height: 400px;">
                    <canvas id="villageReturnChart"></canvas>
                </div>
            </div>

            <!-- 마을 정보 -->
            <div class="briefing-content" id="dailyBriefingContent">
                <div class="briefing-section">
                    <h3>💼 보유 자산</h3>
                    <div id="villageAnalysisAssets" style="margin-top: 15px;">
                        <!-- JavaScript로 동적 생성 -->
                    </div>
                </div>

                <div class="briefing-section">
                    <h3>🤖 AI 포트폴리오 분석</h3>
                    <div id="villageAnalysisAdvice">
                        <!-- JavaScript로 동적 생성 -->
                    </div>
                </div>

                <div class="briefing-section">
                    <h3>⚖️ AI 포트폴리오 리밸런싱</h3>
                    <div id="villageAnalysisRebalancing">
                        <!-- JavaScript로 동적 생성 -->
                    </div>
                </div>
            </div>

            <div class="audio-controls">
                <button class="audio-button" onclick="showPage('villages')" style="background: var(--primary);">마을 관리로 돌아가기</button>
                <button class="audio-button" onclick="showPage('main')" style="background: var(--text-light);">메인으로 돌아가기</button>
            </div>
        </div>
    </div>

    <!-- 이웃 마을 개미 놀러오기 페이지 -->
    <div id="neighborsPage" class="page">
        <div class="container">
            <h1 class="page-title">이웃 마을 개미 놀러오기</h1>
            <p class="page-subtitle">내 포트폴리오의 빈틈을 채워줄 이웃 마을 추천</p>

            <div class="recommendation-grid">
                <!-- 원자재 마을 -->
                <div class="recommendation-card">
                    <div class="rec-header">
                        <div class="rec-icon">🏆</div>
                        <div>
                            <div class="rec-title">원자재 마을</div>
                            <div class="rec-subtitle">금, 은, 원유 ETF</div>
                        </div>
                    </div>

                    <div class="rec-description">
                        <strong>추천 이유:</strong> 현재 포트폴리오가 기술주에 집중되어 있습니다.
                        원자재는 인플레이션 헷지와 포트폴리오 다각화에 효과적입니다.
                        <br><br>
                        <strong>주요 자산:</strong> GLD (금 ETF), SLV (은 ETF), USO (원유 ETF)
                    </div>

                    <div class="correlation-box">
                        <div style="font-size: 14px; margin-bottom: 5px;">1년 평균 수익률</div>
                        <div class="correlation-value" style="color: var(--success);">+8.7%</div>
                        <div style="font-size: 12px; margin-top: 5px;">인플레이션 헷지 효과 포함</div>
                    </div>
                </div>

                <!-- 신흥국 마을 -->
                <div class="recommendation-card">
                    <div class="rec-header">
                        <div class="rec-icon">🌏</div>
                        <div>
                            <div class="rec-title">신흥국 마을</div>
                            <div class="rec-subtitle">인도, 베트남, 브라질</div>
                        </div>
                    </div>

                    <div class="rec-description">
                        <strong>추천 이유:</strong> 미국 시장 편중도가 높습니다.
                        신흥국은 높은 성장 잠재력과 지리적 다각화를 제공합니다.
                        <br><br>
                        <strong>주요 자산:</strong> EPI (인도), VNM (베트남), EWZ (브라질)
                    </div>

                    <div class="correlation-box">
                        <div style="font-size: 14px; margin-bottom: 5px;">1년 평균 수익률</div>
                        <div class="correlation-value" style="color: var(--success);">+12.3%</div>
                        <div style="font-size: 12px; margin-top: 5px;">신흥국 고성장 수혜</div>
                    </div>
                </div>

                <!-- 채권 마을 -->
                <div class="recommendation-card">
                    <div class="rec-header">
                        <div class="rec-icon">🏦</div>
                        <div>
                            <div class="rec-title">채권 마을</div>
                            <div class="rec-subtitle">안전자산 포트폴리오</div>
                        </div>
                    </div>

                    <div class="rec-description">
                        <strong>추천 이유:</strong> 주식 비중이 90% 이상입니다.
                        채권은 하방 리스크를 줄이고 안정적인 수익을 제공합니다.
                        <br><br>
                        <strong>주요 자산:</strong> AGG (종합채권), TLT (장기국채), HYG (하이일드)
                    </div>

                    <div class="correlation-box">
                        <div style="font-size: 14px; margin-bottom: 5px;">1년 평균 수익률</div>
                        <div class="correlation-value" style="color: var(--success);">+5.2%</div>
                        <div style="font-size: 12px; margin-top: 5px;">안정적 이자 수익 기반</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 마이페이지 -->
    <div id="mypagePage" class="page">
        <div class="container">
            <h1 class="page-title">마이페이지</h1>
            <p class="page-subtitle">내 정보와 설정을 관리하세요</p>

            <div class="mypage-grid">
                <!-- 프로필 카드 -->
                <div class="mypage-card">
                    <h2 class="card-title">👤 프로필</h2>

                    <div class="profile-section">
                        <div class="profile-avatar">
                            <div class="avatar-circle" id="avatarDisplay">🐜</div>
                        </div>

                        <div class="form-group">
                            <label>이름</label>
                            <input type="text" id="userName" class="input-field" placeholder="이름을 입력하세요">
                        </div>

                        <div class="form-group">
                            <label>테마</label>
                            <select id="userTheme" class="input-field">
                                <option value="light">라이트 모드</option>
                                <option value="dark">다크 모드</option>
                            </select>
                        </div>

                        <button class="save-button" onclick="saveProfile()">프로필 저장</button>
                    </div>
                </div>

                <!-- 설정 카드 -->
                <div class="mypage-card">
                    <h2 class="card-title">⚙️ 설정</h2>

                    <div class="settings-section">
                        <div class="form-group">
                            <label>브리핑 시간</label>
                            <input type="time" id="briefingTime" class="input-field">
                            <small class="helper-text">매일 아침 브리핑을 받을 시간을 설정하세요</small>
                        </div>

                        <div class="form-group">
                            <label>음성 속도</label>
                            <input type="range" id="voiceSpeed" class="range-slider" min="0.5" max="2.0" step="0.1" value="1.0">
                            <div class="range-value" id="voiceSpeedValue">1.0x</div>
                            <small class="helper-text">TTS 음성 재생 속도를 조절하세요</small>
                        </div>

                        <div class="form-group">
                            <label>글씨 크기</label>
                            <input type="range" id="fontSize" class="range-slider" min="12" max="20" step="1" value="16">
                            <div class="range-value" id="fontSizeValue">16px</div>
                            <small class="helper-text">화면의 기본 글씨 크기를 조절하세요</small>
                        </div>

                        <button class="save-button" onclick="saveSettings()">설정 저장</button>
                    </div>
                </div>

                <!-- 최근 활동 카드 -->
                <div class="mypage-card">
                    <h2 class="card-title">📅 최근 활동</h2>

                    <div class="activity-list" id="activityList">
                        <div class="activity-item">
                            <div class="activity-icon">✨</div>
                            <div class="activity-content">
                                <div class="activity-title">K-AMIs에 오신 것을 환영합니다!</div>
                                <div class="activity-time">방금 전</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 통계 카드 -->
                <div class="mypage-card full-width">
                    <h2 class="card-title">📊 나의 투자 통계</h2>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-icon">💰</div>
                            <div class="stat-label">총 자산</div>
                            <div class="stat-value" id="statTotalAssets">0원</div>
                        </div>

                        <div class="stat-box">
                            <div class="stat-icon">🏘️</div>
                            <div class="stat-label">마을 수</div>
                            <div class="stat-value" id="statVillageCount">0개</div>
                        </div>

                        <div class="stat-box">
                            <div class="stat-icon">📈</div>
                            <div class="stat-label">평균 수익률</div>
                            <div class="stat-value" id="statAvgReturn">0%</div>
                        </div>

                        <div class="stat-box">
                            <div class="stat-icon">🎯</div>
                            <div class="stat-label">보유 자산</div>
                            <div class="stat-value" id="statAssetCount">0개</div>
                        </div>
                    </div>
                </div>

                <!-- 투자 성향 진단 카드 -->
                <div class="mypage-card full-width">
                    <h2 class="card-title">🎯 투자 성향 진단</h2>

                    <div class="investment-test-section">
                        <div class="test-description">
                            <p>25개의 질문을 통해 나의 투자 성향을 분석하고, 맞춤형 포트폴리오를 추천받으세요.</p>
                            <p style="font-size: 14px; color: var(--text-light); margin-top: 8px;">
                                📊 5가지 투자 성향 분석 | ⏱️ 약 5분 소요
                            </p>
                        </div>

                        <div id="testResultSummary" style="display: none; margin-top: 20px;">
                            <!-- 진단 완료 시 요약 표시 -->
                        </div>

                        <button class="test-start-button" onclick="startInvestmentTest()">
                            <span style="font-size: 24px; margin-right: 10px;">🎯</span>
                            <span id="testButtonText">투자 성향 진단 시작하기</span>
                        </button>
                    </div>
                </div>

                <!-- 자산 연동 카드 -->
                <div class="mypage-card full-width">
                    <h2 class="card-title">🔗 자산 연동</h2>

                    <div class="integration-section">
                        <div class="integration-description" id="integrationDescription">
                            <p>마이데이터를 통해 보유 중인 자산을 자동으로 연동하고 최신 정보를 받아보세요.</p>
                            <p style="font-size: 14px; color: var(--text-light); margin-top: 8px;">
                                📱 증권사, 은행 계좌 정보를 안전하게 가져올 수 있습니다.
                            </p>
                        </div>

                        <button class="integration-button" onclick="startMyDataIntegration()" id="integrationButton">
                            <span style="font-size: 24px; margin-right: 10px;" id="integrationIcon">🔄</span>
                            <span id="integrationButtonText">자산 연동 시작하기</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 마이데이터 연동 모달 -->
    <div id="mydataModal" class="modal">
        <div class="modal-content mydata-modal-content">
            <!-- Step 1: 동의 화면 -->
            <div id="mydataStep1" class="mydata-step">
                <div class="mydata-header">
                    <h2 style="color: var(--primary); margin-bottom: 10px;">🔐 마이데이터 연동 동의</h2>
                    <p style="color: var(--text-light); font-size: 14px;">안전한 자산 연동을 위해 동의가 필요합니다</p>
                </div>

                <div class="consent-section">
                    <div class="consent-item">
                        <input type="checkbox" id="consent1" class="consent-checkbox">
                        <label for="consent1" class="consent-label">
                            <strong>개인정보 수집 및 이용 동의 (필수)</strong>
                            <p>자산 정보 연동을 위해 이름, 계좌번호 등 개인정보를 수집합니다.</p>
                        </label>
                    </div>

                    <div class="consent-item">
                        <input type="checkbox" id="consent2" class="consent-checkbox">
                        <label for="consent2" class="consent-label">
                            <strong>금융거래 정보 제공 동의 (필수)</strong>
                            <p>보유 자산, 거래내역 등 금융정보를 제공받는 것에 동의합니다.</p>
                        </label>
                    </div>

                    <div class="consent-item">
                        <input type="checkbox" id="consent3" class="consent-checkbox">
                        <label for="consent3" class="consent-label">
                            <strong>제3자 정보 제공 동의 (필수)</strong>
                            <p>자산 분석 및 포트폴리오 관리를 위해 정보를 활용합니다.</p>
                        </label>
                    </div>

                    <div class="consent-all">
                        <input type="checkbox" id="consentAll" class="consent-checkbox" onchange="toggleAllConsents()">
                        <label for="consentAll" class="consent-label-all">
                            <strong>전체 동의</strong>
                        </label>
                    </div>
                </div>

                <div class="mydata-buttons">
                    <button class="mydata-button secondary" onclick="closeMydataModal()">취소</button>
                    <button class="mydata-button primary" onclick="goToAssetSelection()" id="consentNextBtn" disabled>다음</button>
                </div>
            </div>

            <!-- Step 2: 자산 선택 -->
            <div id="mydataStep2" class="mydata-step" style="display: none;">
                <div class="mydata-header">
                    <h2 style="color: var(--primary); margin-bottom: 10px;">📋 연동할 자산 선택</h2>
                    <p style="color: var(--text-light); font-size: 14px;">연동하려는 금융기관을 선택하세요</p>
                </div>

                <div class="institution-select-all">
                    <input type="checkbox" id="selectAllInstitutions" class="institution-checkbox" onchange="toggleAllInstitutions()">
                    <label for="selectAllInstitutions" class="select-all-label">
                        <strong>전체 선택</strong>
                    </label>
                </div>

                <div class="institution-list" id="institutionList">
                    <!-- JavaScript로 동적 생성 -->
                </div>

                <div class="mydata-buttons">
                    <button class="mydata-button secondary" onclick="backToConsent()">이전</button>
                    <button class="mydata-button primary" onclick="startIntegrationLoading()">연동 시작</button>
                </div>
            </div>

            <!-- Step 3: 로딩 -->
            <div id="mydataStep3" class="mydata-step" style="display: none;">
                <div class="mydata-header">
                    <h2 style="color: var(--primary); margin-bottom: 10px;">⏳ 자산 연동 중</h2>
                    <p style="color: var(--text-light); font-size: 14px;">잠시만 기다려주세요...</p>
                </div>

                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <div class="loading-message" id="loadingMessage">금융기관 연결 중...</div>
                    <div class="loading-progress">
                        <div class="progress-bar-mydata">
                            <div class="progress-fill-mydata" id="progressFill"></div>
                        </div>
                        <div class="progress-text" id="progressText">0%</div>
                    </div>
                </div>
            </div>

            <!-- Step 4: 완료 -->
            <div id="mydataStep4" class="mydata-step" style="display: none;">
                <div class="mydata-header">
                    <h2 style="color: var(--success); margin-bottom: 10px;">✅ 연동 완료!</h2>
                    <p style="color: var(--text-light); font-size: 14px;">자산 정보가 성공적으로 연동되었습니다</p>
                </div>

                <div class="completion-summary" id="completionSummary">
                    <!-- JavaScript로 동적 생성 -->
                </div>

                <div class="completion-message">
                    <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, var(--stat-bg-start) 0%, var(--stat-bg-end) 100%); border-radius: 15px;">
                        <p style="font-size: 18px; font-weight: 600; color: var(--dark); margin-bottom: 10px;">🎉 환영합니다!</p>
                        <p style="color: var(--text);">이제 K-AMIs에서 모든 자산을 한눈에 관리하세요.</p>
                    </div>
                </div>

                <div class="mydata-buttons">
                    <button class="mydata-button primary full-width" onclick="finishIntegration()">확인</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 모달 -->
    <div id="villageModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <!-- 확인 모달 -->
    <div id="confirmModal" class="modal">
        <div class="modal-content confirm-modal-content">
            <div class="confirm-header">
                <div class="confirm-icon" id="confirmIcon">❓</div>
                <h3 class="confirm-title" id="confirmTitle">확인</h3>
                <p class="confirm-message" id="confirmMessage">정말로 진행하시겠습니까?</p>
            </div>
            <div class="confirm-buttons">
                <button class="confirm-button cancel" id="confirmCancelBtn">취소</button>
                <button class="confirm-button confirm" id="confirmConfirmBtn">확인</button>
            </div>
        </div>
    </div>

    <!-- 투자 성향 진단 모달 -->
    <div id="investmentTestModal" class="modal">
        <div class="modal-content investment-test-modal-content">
            <span class="close-modal" onclick="closeInvestmentTest()">&times;</span>

            <!-- 진단 진행 중 -->
            <div id="testQuestionsSection">
                <div class="test-header">
                    <h2 style="color: var(--primary); margin-bottom: 10px;">🎯 투자 성향 진단</h2>
                    <div class="test-progress">
                        <div class="progress-bar-test">
                            <div class="progress-fill-test" id="testProgressFill"></div>
                        </div>
                        <div class="progress-text-test" id="testProgressText">1 / 25</div>
                    </div>
                </div>

                <div class="test-question-container">
                    <h3 class="test-question" id="testQuestion">질문이 여기에 표시됩니다</h3>
                    <div class="test-answers" id="testAnswers">
                        <!-- JavaScript로 동적 생성 -->
                    </div>
                </div>

                <div class="test-navigation">
                    <button class="test-nav-button" id="prevButton" onclick="previousQuestion()" disabled>이전</button>
                    <button class="test-nav-button primary" id="nextButton" onclick="nextQuestion()" disabled>다음</button>
                </div>
            </div>

            <!-- 진단 결과 -->
            <div id="testResultSection" style="display: none;">
                <div class="test-header">
                    <h2 style="color: var(--success); margin-bottom: 10px;">✅ 진단 완료!</h2>
                    <p style="color: var(--text-light); font-size: 14px;">당신의 투자 성향을 분석했습니다</p>
                </div>

                <div class="result-main-type" id="resultMainType">
                    <!-- JavaScript로 동적 생성 -->
                </div>

                <div class="result-chart-container">
                    <canvas id="resultChart"></canvas>
                </div>

                <div class="result-description" id="resultDescription">
                    <!-- JavaScript로 동적 생성 -->
                </div>

                <div class="result-portfolio" id="resultPortfolio">
                    <!-- JavaScript로 동적 생성 -->
                </div>

                <div class="test-result-buttons">
                    <button class="test-nav-button" onclick="retakeTest()">다시 진단하기</button>
                    <button class="test-nav-button primary" onclick="closeInvestmentTest()">확인</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 마을 추가 모달 -->
    <div id="addVillageModal" class="modal">
        <div class="modal-content mydata-modal-content">
            <span class="close-modal" onclick="closeAddVillageModal()">&times;</span>

            <div class="mydata-header">
                <h2 style="color: var(--primary); margin-bottom: 10px;">🏘️ 새로운 마을 추가</h2>
                <p style="color: var(--text-light); font-size: 14px;">나만의 투자 마을을 만들어보세요</p>
            </div>

            <form onsubmit="submitNewVillage(event)" style="display: flex; flex-direction: column; gap: 20px;">
                <!-- 마을 이름 -->
                <div class="form-group">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--dark);">마을 이름 *</label>
                    <input type="text" id="newVillageName" class="input-field" placeholder="예: AI 반도체 마을" required>
                </div>

                <!-- 추가할 종목 -->
                <div class="form-group">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--dark);">추가할 종목</label>
                    <div style="border: 2px solid var(--light); border-radius: 10px; padding: 15px; max-height: 200px; overflow-y: auto;">
                        <div id="assetCheckboxList" style="display: flex; flex-direction: column; gap: 10px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" name="villageAssets" value="AAPL" style="width: 18px; height: 18px; cursor: pointer;">
                                <span>AAPL - Apple Inc. (기술주)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" name="villageAssets" value="TSLA" style="width: 18px; height: 18px; cursor: pointer;">
                                <span>TSLA - Tesla Inc. (성장주)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" name="villageAssets" value="NVDA" style="width: 18px; height: 18px; cursor: pointer;">
                                <span>NVDA - NVIDIA Corp. (AI주)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" name="villageAssets" value="MSFT" style="width: 18px; height: 18px; cursor: pointer;">
                                <span>MSFT - Microsoft Corp. (기술주)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" name="villageAssets" value="삼성전자" style="width: 18px; height: 18px; cursor: pointer;">
                                <span>삼성전자 (한국주식)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" name="villageAssets" value="SK하이닉스" style="width: 18px; height: 18px; cursor: pointer;">
                                <span>SK하이닉스 (한국주식)</span>
                            </label>
                        </div>
                    </div>
                    <small class="helper-text">보유 중인 종목에서 선택하세요 (선택사항)</small>
                </div>

                <!-- 투자 유형 -->
                <div class="form-group">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--dark);">투자 유형 *</label>
                    <select id="newVillageType" class="input-field" required>
                        <option value="">선택하세요</option>
                        <option value="dividend">배당형</option>
                        <option value="growth">성장형</option>
                        <option value="long-term">장기투자형</option>
                        <option value="short-term">단기투자형</option>
                        <option value="leverage">레버리지형</option>
                        <option value="mixed">복합형</option>
                    </select>
                </div>

                <!-- 투자 목표 -->
                <div class="form-group">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--dark);">투자 목표 *</label>
                    <select id="newVillageGoal" class="input-field" required>
                        <option value="">선택하세요</option>
                        <option value="long-term">장기 투자</option>
                        <option value="passive-income">배당 소득</option>
                        <option value="high-risk">고위험 고수익</option>
                        <option value="balanced">균형 투자</option>
                        <option value="diversification">분산 투자</option>
                        <option value="sector-focus">섹터 집중</option>
                    </select>
                </div>

                <!-- 마을 아이콘 -->
                <div class="form-group">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--dark);">마을 아이콘 *</label>
                    <div class="icon-slider-container">
                        <button type="button" class="icon-select-btn" data-icon="🏘️" onclick="selectVillageIcon('🏘️')">🏘️</button>
                        <button type="button" class="icon-select-btn" data-icon="🚀" onclick="selectVillageIcon('🚀')">🚀</button>
                        <button type="button" class="icon-select-btn" data-icon="💎" onclick="selectVillageIcon('💎')">💎</button>
                        <button type="button" class="icon-select-btn" data-icon="🌟" onclick="selectVillageIcon('🌟')">🌟</button>
                        <button type="button" class="icon-select-btn" data-icon="💰" onclick="selectVillageIcon('💰')">💰</button>
                        <button type="button" class="icon-select-btn" data-icon="📈" onclick="selectVillageIcon('📈')">📈</button>
                        <button type="button" class="icon-select-btn" data-icon="🎯" onclick="selectVillageIcon('🎯')">🎯</button>
                        <button type="button" class="icon-select-btn" data-icon="🔥" onclick="selectVillageIcon('🔥')">🔥</button>
                        <button type="button" class="icon-select-btn" data-icon="⚡" onclick="selectVillageIcon('⚡')">⚡</button>
                        <button type="button" class="icon-select-btn" data-icon="🌈" onclick="selectVillageIcon('🌈')">🌈</button>
                        <button type="button" class="icon-select-btn" data-icon="🏆" onclick="selectVillageIcon('🏆')">🏆</button>
                        <button type="button" class="icon-select-btn" data-icon="💻" onclick="selectVillageIcon('💻')">💻</button>
                        <button type="button" class="icon-select-btn" data-icon="🤖" onclick="selectVillageIcon('🤖')">🤖</button>
                        <button type="button" class="icon-select-btn" data-icon="🔬" onclick="selectVillageIcon('🔬')">🔬</button>
                        <button type="button" class="icon-select-btn" data-icon="🏦" onclick="selectVillageIcon('🏦')">🏦</button>
                        <button type="button" class="icon-select-btn" data-icon="🌍" onclick="selectVillageIcon('🌍')">🌍</button>
                        <button type="button" class="icon-select-btn" data-icon="🎨" onclick="selectVillageIcon('🎨')">🎨</button>
                        <button type="button" class="icon-select-btn" data-icon="🎪" onclick="selectVillageIcon('🎪')">🎪</button>
                        <button type="button" class="icon-select-btn" data-icon="🎭" onclick="selectVillageIcon('🎭')">🎭</button>
                        <button type="button" class="icon-select-btn" data-icon="🎬" onclick="selectVillageIcon('🎬')">🎬</button>
                    </div>
                    <input type="hidden" id="newVillageIcon" value="🏘️" required>
                    <small class="helper-text">좌우로 슬라이드하여 아이콘을 선택하세요</small>
                </div>

                <!-- 특이사항/메모 -->
                <div class="form-group">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--dark);">특이사항 / 투자 전략</label>
                    <div id="villageNotesList" style="display: flex; flex-direction: column; gap: 10px;">
                        <div class="note-item" style="display: flex; gap: 8px;">
                            <input type="text" class="input-field village-note" placeholder="예: 기술주 위주 포트폴리오" style="flex: 1;">
                            <button type="button" class="note-remove-btn" onclick="removeNoteItem(this)" style="background: var(--danger); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 16px;">×</button>
                        </div>
                    </div>
                    <button type="button" onclick="addNoteItem()" style="margin-top: 10px; background: var(--light); border: 2px dashed var(--text-light); color: var(--text); padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; width: 100%;">+ 항목 추가</button>
                    <small class="helper-text">투자 전략이나 특이사항을 한 줄씩 추가하세요</small>
                </div>

                <!-- 버튼 -->
                <div class="mydata-buttons">
                    <button type="button" class="mydata-button secondary" onclick="closeAddVillageModal()">취소</button>
                    <button type="submit" class="mydata-button primary">마을 추가</button>
                </div>
            </form>
        </div>
    </div>

    <!-- JavaScript 파일들 (순서 중요: 데이터 → API → 유틸 → 기능 모듈 → 인증) -->
    <script src="js/data.js"></script>
    <script src="js/api.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/ui-utils.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/villages.js"></script>
    <script src="js/main-page.js"></script>
    <script src="js/analysis.js"></script>
    <script src="js/mypage.js"></script>
    <script src="js/mydata.js"></script>
    <script src="js/investment-test.js"></script>
    <script src="js/auth.js"></script>
</body>
</html>
