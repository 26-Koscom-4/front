<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-AMIs (캐미s) - Ant Village</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.js"></script>
</head>
<body>
    <!-- 로그인 페이지 -->
    <div id="loginPage" class="page active">
        <div class="login-container">
            <div class="login-card">
                <div class="login-logo">
                    <img src="public/logo.png" alt="K-AMIs Logo" class="login-logo-image">
                </div>

                <h1 class="login-title">K-AMIs (캐미s)</h1>
                <p class="login-subtitle">개미 마을에 오신 것을 환영합니다</p>

                <form class="login-form" onsubmit="handleLogin(event)">
                    <div class="login-input-group">
                        <label for="loginId" class="login-label">아이디</label>
                        <input
                            type="text"
                            id="loginId"
                            class="login-input"
                            placeholder="아이디를 입력하세요"
                            autocomplete="username"
                        >
                    </div>

                    <div class="login-input-group">
                        <label for="loginPw" class="login-label">비밀번호</label>
                        <input
                            type="password"
                            id="loginPw"
                            class="login-input"
                            placeholder="비밀번호를 입력하세요"
                            autocomplete="current-password"
                        >
                    </div>

                    <button type="submit" class="login-button">
                        로그인
                    </button>
                </form>

                <div class="login-footer">
                    <p style="color: var(--text-light); font-size: 14px;">
                        💡 데모 버전: 아이디와 비밀번호를 입력하시면 바로 로그인됩니다
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- 헤더 -->
    <header id="mainHeader" style="display: none;">
        <div class="container">
            <div class="logo" onclick="showPage('main')">
                <img src="public/logo.png" alt="K-AMIs Logo" class="logo-image">
                <span class="logo-text">K-AMIs (캐미s)</span>
            </div>
            <nav>
                <button onclick="showPage('main')">홈</button>
                <button onclick="showPage('villages')">마을 관리</button>
                <button onclick="showPage('briefing')">아침 브리핑</button>
                <button onclick="showPage('neighbors')">이웃 개미</button>
                <button onclick="showPage('mypage')">마이페이지</button>
                <button onclick="logout()" class="logout-button">로그아웃</button>
            </nav>
        </div>
    </header>

    <!-- 메인 페이지 -->
    <div id="mainPage" class="page active">
        <div class="hero">
            <h1>개미 마을</h1>
            <p>"방치된 내 주식, 개미 마을이 깨워줍니다."</p>
            <button class="cta-button" onclick="showPage('villages')">내 마을 시작하기 🚀</button>
        </div>

        <div class="world-map">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--dark);">전 세계 나의 투자 마을</h2>
            <div class="map-container">
                <img src="public/map.png" alt="세계 지도" class="map-image">

                <!-- 클릭 가능한 지역 핫스팟 -->
                <div class="map-hotspot hotspot-korea" onclick="showVillageDetail('국장마을')" title="한국">
                    <span class="hotspot-label">🇰🇷 한국</span>
                    <span class="unread-badge" id="badge-국장마을" style="display: none;">NEW</span>
                </div>
                <div class="map-hotspot hotspot-usa" onclick="showVillageDetail('미장마을')" title="미국">
                    <span class="hotspot-label">🇺🇸 미국</span>
                    <span class="unread-badge" id="badge-미장마을" style="display: none;">NEW</span>
                </div>
                <div class="map-hotspot hotspot-europe" onclick="showVillageDetail('배당마을')" title="유럽">
                    <span class="hotspot-label">🇪🇺 유럽</span>
                    <span class="unread-badge" id="badge-배당마을" style="display: none;">NEW</span>
                </div>
                <div class="map-hotspot hotspot-asia" onclick="showVillageDetail('글로벌ETF마을')" title="아시아">
                    <span class="hotspot-label">🌏 아시아</span>
                    <span class="unread-badge" id="badge-글로벌ETF마을" style="display: none;">NEW</span>
                </div>
            </div>
        </div>

        <!-- 자산 분포 차트 -->
        <div class="asset-chart-section">
            <div class="container">
                <h2 class="section-title">내 자산 분포</h2>
                <p class="section-subtitle">마을별 자산 비중을 한눈에 확인하세요</p>

                <div class="chart-wrapper">
                    <div class="chart-container">
                        <canvas id="assetPieChart"></canvas>
                    </div>

                    <div class="chart-legend">
                        <h3>총 자산</h3>
                        <div class="total-assets" id="totalAssets">0원</div>

                        <div class="legend-items" id="legendItems">
                            <!-- JavaScript로 동적 생성 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 마을 관리 페이지 -->
    <div id="villagesPage" class="page">
        <div class="container">
            <h1 class="page-title">나의 마을 관리</h1>
            <p class="page-subtitle">내 자산을 성격에 따라 마을로 분리하세요</p>

            <div class="village-grid" id="villageGrid">
                <!-- JavaScript로 동적 생성 -->
            </div>
        </div>
    </div>

    <!-- 아침 브리핑 페이지 -->
    <div id="briefingPage" class="page">
        <div class="container">
            <h1 class="page-title">개미 아침 브리핑</h1>
            <p class="page-subtitle">눈으로 보지 말고, 귀로 듣는 출근길 투자 전략</p>

            <div class="briefing-container">
                <div class="ant-character">
                    <div class="ant-avatar">🐜</div>
                    <div class="ant-name">브리핑 개미</div>
                </div>

                <div class="briefing-content" id="briefingContent">
                    <div class="briefing-section">
                        <h3>📊 전일 시장 요약</h3>
                        <p>주인님, 좋은 아침입니다! 어제 미국 증시는 혼조세를 보였습니다.</p>
                        <p>S&P 500 지수는 0.3% 상승한 4,785포인트로 마감했으며, 나스닥은 0.5% 상승했습니다.</p>
                    </div>

                    <div class="briefing-section">
                        <h3>🎯 내 포트폴리오 핵심 이슈</h3>
                        <p><strong>미장마을</strong> - NVDA가 3.2% 상승했습니다. AI 칩 수요 증가 전망이 긍정적입니다.</p>
                        <p><strong>미장마을</strong> - AAPL은 1.5% 하락했습니다. 아이폰 판매량 우려가 반영되었습니다.</p>
                        <p><strong>배당마을</strong> - SCHD는 보합세를 유지했습니다. 안정적인 배당 수익 유지 중입니다.</p>
                    </div>

                    <div class="briefing-section">
                        <h3>📅 금일 주요 일정</h3>
                        <p>• 오전 10시: 미국 소비자물가지수(CPI) 발표 예정</p>
                        <p>• 오후 3시: 연준 의장 제롬 파월 연설</p>
                        <p>• 장마감 후: 테슬라(TSLA) 실적 발표</p>
                    </div>
                </div>

                <div class="audio-controls">
                    <button class="audio-button" onclick="playBriefing()">🔊 음성으로 듣기</button>
                    <button class="audio-button" onclick="stopBriefing()">⏹️ 정지</button>
                    <button class="audio-button" onclick="showPage('villages')">마을로 돌아가기</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 마을별 정기 브리핑 페이지 -->
    <div id="dailyBriefingPage" class="page">
        <div class="container">
            <h1 class="page-title">마을별 정기 브리핑</h1>
            <p class="page-subtitle">시간대별 맞춤 정보 제공</p>

            <div class="briefing-container">
                <div class="ant-character">
                    <div class="ant-avatar">🏘️</div>
                    <div class="ant-name" id="dailyVillageName">미장마을</div>
                </div>

                <div class="briefing-content" id="dailyBriefingContent">
                    <div class="briefing-section">
                        <h3>🌅 장전 브리핑 (오전 8시)</h3>
                        <p>미장마을의 오늘 전망입니다.</p>
                        <p>선물 지수는 +0.5% 상승 중이며, 긍정적인 출발이 예상됩니다.</p>
                    </div>

                    <div class="briefing-section">
                        <h3>⚡ 레버리지마을 특별 경고</h3>
                        <p style="color: var(--danger); font-weight: 700;">변동성 지수(VIX)가 18.5로 상승했습니다.</p>
                        <p>레버리지 포지션 점검을 권장드립니다.</p>
                    </div>

                    <div class="briefing-section">
                        <h3>💰 배당마을 D-Day 알림</h3>
                        <p>SCHD 배당락일까지 <strong>3일</strong> 남았습니다.</p>
                        <p>예상 배당 수익: $127.50</p>
                    </div>
                </div>

                <div class="audio-controls">
                    <button class="audio-button" onclick="playDailyBriefing()">🔊 음성으로 듣기</button>
                    <button class="audio-button" onclick="stopBriefing()">⏹️ 정지</button>
                    <button class="audio-button" onclick="showPage('main')">메인으로 돌아가기</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 이웃 개미 놀러오기 페이지 -->
    <div id="neighborsPage" class="page">
        <div class="container">
            <h1 class="page-title">이웃 개미 놀러오기</h1>
            <p class="page-subtitle">내 포트폴리오의 빈틈을 채워줄 이웃 마을 추천</p>

            <div class="recommendation-grid">
                <!-- 원자재 마을 -->
                <div class="recommendation-card">
                    <div class="rec-header">
                        <div class="rec-icon">🏆</div>
                        <div>
                            <div class="rec-title">원자재 마을</div>
                            <div class="rec-subtitle">금, 은, 원유 ETF</div>
                        </div>
                    </div>

                    <div class="rec-description">
                        <strong>추천 이유:</strong> 현재 포트폴리오가 기술주에 집중되어 있습니다.
                        원자재는 인플레이션 헷지와 포트폴리오 다각화에 효과적입니다.
                        <br><br>
                        <strong>주요 자산:</strong> GLD (금 ETF), SLV (은 ETF), USO (원유 ETF)
                    </div>

                    <div class="correlation-box">
                        <div style="font-size: 14px; margin-bottom: 5px;">기존 포트폴리오와의 상관관계</div>
                        <div class="correlation-value">-0.23</div>
                        <div style="font-size: 12px; margin-top: 5px;">낮은 상관관계 = 분산 효과 우수</div>
                    </div>

                    <button class="add-village-btn" onclick="addVillage('원자재 마을')">마을 추가하기</button>
                </div>

                <!-- 신흥국 마을 -->
                <div class="recommendation-card">
                    <div class="rec-header">
                        <div class="rec-icon">🌏</div>
                        <div>
                            <div class="rec-title">신흥국 마을</div>
                            <div class="rec-subtitle">인도, 베트남, 브라질</div>
                        </div>
                    </div>

                    <div class="rec-description">
                        <strong>추천 이유:</strong> 미국 시장 편중도가 높습니다.
                        신흥국은 높은 성장 잠재력과 지리적 다각화를 제공합니다.
                        <br><br>
                        <strong>주요 자산:</strong> EPI (인도), VNM (베트남), EWZ (브라질)
                    </div>

                    <div class="correlation-box">
                        <div style="font-size: 14px; margin-bottom: 5px;">기존 포트폴리오와의 상관관계</div>
                        <div class="correlation-value">-0.15</div>
                        <div style="font-size: 12px; margin-top: 5px;">지리적 분산 효과</div>
                    </div>

                    <button class="add-village-btn" onclick="addVillage('신흥국 마을')">마을 추가하기</button>
                </div>

                <!-- 채권 마을 -->
                <div class="recommendation-card">
                    <div class="rec-header">
                        <div class="rec-icon">🏦</div>
                        <div>
                            <div class="rec-title">채권 마을</div>
                            <div class="rec-subtitle">안전자산 포트폴리오</div>
                        </div>
                    </div>

                    <div class="rec-description">
                        <strong>추천 이유:</strong> 주식 비중이 90% 이상입니다.
                        채권은 하방 리스크를 줄이고 안정적인 수익을 제공합니다.
                        <br><br>
                        <strong>주요 자산:</strong> AGG (종합채권), TLT (장기국채), HYG (하이일드)
                    </div>

                    <div class="correlation-box">
                        <div style="font-size: 14px; margin-bottom: 5px;">기존 포트폴리오와의 상관관계</div>
                        <div class="correlation-value">-0.40</div>
                        <div style="font-size: 12px; margin-top: 5px;">역상관 = 최고의 헷징 효과</div>
                    </div>

                    <button class="add-village-btn" onclick="addVillage('채권 마을')">마을 추가하기</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 마이페이지 -->
    <div id="mypagePage" class="page">
        <div class="container">
            <h1 class="page-title">마이페이지</h1>
            <p class="page-subtitle">내 정보와 설정을 관리하세요</p>

            <div class="mypage-grid">
                <!-- 프로필 카드 -->
                <div class="mypage-card">
                    <h2 class="card-title">👤 프로필</h2>

                    <div class="profile-section">
                        <div class="profile-avatar">
                            <div class="avatar-circle" id="avatarDisplay">🐜</div>
                        </div>

                        <div class="form-group">
                            <label>이름</label>
                            <input type="text" id="userName" class="input-field" placeholder="이름을 입력하세요">
                        </div>

                        <div class="form-group">
                            <label>테마</label>
                            <select id="userTheme" class="input-field">
                                <option value="light">라이트 모드</option>
                                <option value="dark">다크 모드</option>
                            </select>
                        </div>

                        <button class="save-button" onclick="saveProfile()">프로필 저장</button>
                    </div>
                </div>

                <!-- 설정 카드 -->
                <div class="mypage-card">
                    <h2 class="card-title">⚙️ 설정</h2>

                    <div class="settings-section">
                        <div class="form-group">
                            <label>브리핑 시간</label>
                            <input type="time" id="briefingTime" class="input-field">
                            <small class="helper-text">매일 아침 브리핑을 받을 시간을 설정하세요</small>
                        </div>

                        <div class="form-group">
                            <label>음성 속도</label>
                            <input type="range" id="voiceSpeed" class="range-slider" min="0.5" max="2.0" step="0.1" value="1.0">
                            <div class="range-value" id="voiceSpeedValue">1.0x</div>
                            <small class="helper-text">TTS 음성 재생 속도를 조절하세요</small>
                        </div>

                        <button class="save-button" onclick="saveSettings()">설정 저장</button>
                    </div>
                </div>

                <!-- 통계 카드 -->
                <div class="mypage-card full-width">
                    <h2 class="card-title">📊 나의 투자 통계</h2>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-icon">💰</div>
                            <div class="stat-label">총 자산</div>
                            <div class="stat-value" id="statTotalAssets">0원</div>
                        </div>

                        <div class="stat-box">
                            <div class="stat-icon">🏘️</div>
                            <div class="stat-label">마을 수</div>
                            <div class="stat-value" id="statVillageCount">0개</div>
                        </div>

                        <div class="stat-box">
                            <div class="stat-icon">📈</div>
                            <div class="stat-label">평균 수익률</div>
                            <div class="stat-value" id="statAvgReturn">0%</div>
                        </div>

                        <div class="stat-box">
                            <div class="stat-icon">🎯</div>
                            <div class="stat-label">보유 자산</div>
                            <div class="stat-value" id="statAssetCount">0개</div>
                        </div>
                    </div>
                </div>

                <!-- 최근 활동 카드 -->
                <div class="mypage-card full-width">
                    <h2 class="card-title">📅 최근 활동</h2>

                    <div class="activity-list" id="activityList">
                        <div class="activity-item">
                            <div class="activity-icon">✨</div>
                            <div class="activity-content">
                                <div class="activity-title">K-AMIs에 오신 것을 환영합니다!</div>
                                <div class="activity-time">방금 전</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 자산 연동 카드 -->
                <div class="mypage-card full-width">
                    <h2 class="card-title">🔗 자산 연동</h2>

                    <div class="integration-section">
                        <div class="integration-description" id="integrationDescription">
                            <p>마이데이터를 통해 보유 중인 자산을 자동으로 연동하고 최신 정보를 받아보세요.</p>
                            <p style="font-size: 14px; color: var(--text-light); margin-top: 8px;">
                                📱 증권사, 은행 계좌 정보를 안전하게 가져올 수 있습니다.
                            </p>
                        </div>

                        <button class="integration-button" onclick="startMyDataIntegration()" id="integrationButton">
                            <span style="font-size: 24px; margin-right: 10px;" id="integrationIcon">🔄</span>
                            <span id="integrationButtonText">자산 연동 시작하기</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 마이데이터 연동 모달 -->
    <div id="mydataModal" class="modal">
        <div class="modal-content mydata-modal-content">
            <!-- Step 1: 동의 화면 -->
            <div id="mydataStep1" class="mydata-step">
                <div class="mydata-header">
                    <h2 style="color: var(--primary); margin-bottom: 10px;">🔐 마이데이터 연동 동의</h2>
                    <p style="color: var(--text-light); font-size: 14px;">안전한 자산 연동을 위해 동의가 필요합니다</p>
                </div>

                <div class="consent-section">
                    <div class="consent-item">
                        <input type="checkbox" id="consent1" class="consent-checkbox">
                        <label for="consent1" class="consent-label">
                            <strong>개인정보 수집 및 이용 동의 (필수)</strong>
                            <p>자산 정보 연동을 위해 이름, 계좌번호 등 개인정보를 수집합니다.</p>
                        </label>
                    </div>

                    <div class="consent-item">
                        <input type="checkbox" id="consent2" class="consent-checkbox">
                        <label for="consent2" class="consent-label">
                            <strong>금융거래 정보 제공 동의 (필수)</strong>
                            <p>보유 자산, 거래내역 등 금융정보를 제공받는 것에 동의합니다.</p>
                        </label>
                    </div>

                    <div class="consent-item">
                        <input type="checkbox" id="consent3" class="consent-checkbox">
                        <label for="consent3" class="consent-label">
                            <strong>제3자 정보 제공 동의 (필수)</strong>
                            <p>자산 분석 및 포트폴리오 관리를 위해 정보를 활용합니다.</p>
                        </label>
                    </div>

                    <div class="consent-all">
                        <input type="checkbox" id="consentAll" class="consent-checkbox" onchange="toggleAllConsents()">
                        <label for="consentAll" class="consent-label-all">
                            <strong>전체 동의</strong>
                        </label>
                    </div>
                </div>

                <div class="mydata-buttons">
                    <button class="mydata-button secondary" onclick="closeMydataModal()">취소</button>
                    <button class="mydata-button primary" onclick="goToAssetSelection()" id="consentNextBtn" disabled>다음</button>
                </div>
            </div>

            <!-- Step 2: 자산 선택 -->
            <div id="mydataStep2" class="mydata-step" style="display: none;">
                <div class="mydata-header">
                    <h2 style="color: var(--primary); margin-bottom: 10px;">📋 연동할 자산 선택</h2>
                    <p style="color: var(--text-light); font-size: 14px;">연동하려는 금융기관을 선택하세요</p>
                </div>

                <div class="institution-select-all">
                    <input type="checkbox" id="selectAllInstitutions" class="institution-checkbox" onchange="toggleAllInstitutions()">
                    <label for="selectAllInstitutions" class="select-all-label">
                        <strong>전체 선택</strong>
                    </label>
                </div>

                <div class="institution-list" id="institutionList">
                    <!-- JavaScript로 동적 생성 -->
                </div>

                <div class="mydata-buttons">
                    <button class="mydata-button secondary" onclick="backToConsent()">이전</button>
                    <button class="mydata-button primary" onclick="startIntegrationLoading()">연동 시작</button>
                </div>
            </div>

            <!-- Step 3: 로딩 -->
            <div id="mydataStep3" class="mydata-step" style="display: none;">
                <div class="mydata-header">
                    <h2 style="color: var(--primary); margin-bottom: 10px;">⏳ 자산 연동 중</h2>
                    <p style="color: var(--text-light); font-size: 14px;">잠시만 기다려주세요...</p>
                </div>

                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <div class="loading-message" id="loadingMessage">금융기관 연결 중...</div>
                    <div class="loading-progress">
                        <div class="progress-bar-mydata">
                            <div class="progress-fill-mydata" id="progressFill"></div>
                        </div>
                        <div class="progress-text" id="progressText">0%</div>
                    </div>
                </div>
            </div>

            <!-- Step 4: 완료 -->
            <div id="mydataStep4" class="mydata-step" style="display: none;">
                <div class="mydata-header">
                    <h2 style="color: var(--success); margin-bottom: 10px;">✅ 연동 완료!</h2>
                    <p style="color: var(--text-light); font-size: 14px;">자산 정보가 성공적으로 연동되었습니다</p>
                </div>

                <div class="completion-summary" id="completionSummary">
                    <!-- JavaScript로 동적 생성 -->
                </div>

                <div class="completion-message">
                    <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, var(--stat-bg-start) 0%, var(--stat-bg-end) 100%); border-radius: 15px;">
                        <p style="font-size: 18px; font-weight: 600; color: var(--dark); margin-bottom: 10px;">🎉 환영합니다!</p>
                        <p style="color: var(--text);">이제 K-AMIs에서 모든 자산을 한눈에 관리하세요.</p>
                    </div>
                </div>

                <div class="mydata-buttons">
                    <button class="mydata-button primary full-width" onclick="finishIntegration()">확인</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 모달 -->
    <div id="villageModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
